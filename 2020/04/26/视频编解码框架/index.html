<!DOCTYPE html>

<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  
  <title>视频编解码框架 [ Hexo ]</title>
  
    <!-- stylesheets list from config.yml -->
    
      <link rel="stylesheet" href="/css/iLiKE.css">
    
  
  
  
  <script src="//cdn1.lncld.net/static/js/3.1.1/av-min.js"></script>
    <script id="leancloud">
      AV.init({
          appId: "6E5zTbTljdUbVW2WkXPsXGJk-gzGzoHsz",
          appKey: "0vsyDKfNpeSECAI70J794ugv"
      });
    </script>

<meta name="generator" content="Hexo 4.2.0"></head>
<body>
    <div class="header">
        <div class="container">
    <div class="menu">
      <div class="menu-left">
        <a href="/">
          <img src="/favicon.ico"></img>
        </a>
      </div>
      <div class="menu-right">
        
          
          
          
          
          
          
          <a href="/">Home</a>
        
          
          
          
          
          
          
          <a href="/archives">Archives</a>
        
          
          
          
          
          
          
          <a href="/about">About</a>
        
          
          
          
          
          
          
          <a href="/tags">Tags</a>
        
      </div>
    </div>
</div>
    </div>
    <div class="container">
        <h1 class="post-title">视频编解码框架</h1>
<article class="post markdown-style">
  <p>网址：<br><a href="https://www.cnblogs.com/xkfz007/archive/2012/07/29/2613824.html" target="_blank" rel="noopener">https://www.cnblogs.com/xkfz007/archive/2012/07/29/2613824.html</a><br>HEVC视频标准编码框架<br><a href="https://blog.csdn.net/shayashi/article/details/86594437" target="_blank" rel="noopener">https://blog.csdn.net/shayashi/article/details/86594437</a><br><a href="https://segmentfault.com/a/1190000007591750" target="_blank" rel="noopener">https://segmentfault.com/a/1190000007591750</a><br>双目视觉—图像匹配基本算法总结<br><a href="https://blog.csdn.net/u010368556/article/details/72596869/" target="_blank" rel="noopener">https://blog.csdn.net/u010368556/article/details/72596869/</a><br>opencv的框架与各模块功能介绍<br><a href="https://blog.csdn.net/u012679707/article/details/79505279" target="_blank" rel="noopener">https://blog.csdn.net/u012679707/article/details/79505279</a><br>经典视频编解码框架理解【经典参考】<br><a href="https://blog.csdn.net/shaoyiting/article/details/53526304" target="_blank" rel="noopener">https://blog.csdn.net/shaoyiting/article/details/53526304</a><br><a href="https://www.cnblogs.com/xiezhaohai/p/6839606.html" target="_blank" rel="noopener">https://www.cnblogs.com/xiezhaohai/p/6839606.html</a><br><a href="https://www.doc88.com/p-1896428145130.html" target="_blank" rel="noopener">https://www.doc88.com/p-1896428145130.html</a><br><a href="https://blog.csdn.net/dongshizhishui/article/details/99646512" target="_blank" rel="noopener">https://blog.csdn.net/dongshizhishui/article/details/99646512</a></p>
<p>第四章 视频编码基础</p>
<ol>
<li>压缩码流</li>
</ol>
<p>语法：码流中各个元素的位置关系<br>01001001…<br>图像编码类型(01)，宏块类型(00)，编码系数1001等<br>语义：每个语法元素所表达的意义。<br>例如：图像编码类型</p>
<ol start="2">
<li>编码层次</li>
</ol>
<p>序列（Sequence）<br>图像组（Group of Pictures，GOP）<br>图像（Picture）<br>条带（Slice）<br>宏块（Macroblock，MB）<br>块(Block)<br>3. 码流结构</p>
<ol start="3">
<li>PB帧编码</li>
</ol>
<ol start="4">
<li>序列编码对象</li>
</ol>
<p>（1）IBBP序列</p>
<p>序列：一段连续编码的并具有相同参数的视频图像。<br>序列起始码：专有的一段比特串，标识一个序列的压缩数据的开始<br>MPEG-2的序列起始码为十六进制数000001(B3)。<br>序列头：记录序列信息<br>档次（Profile），级别（Level），宽度，高度，是否是逐行序列，帧率等。<br>序列结束码：专有的一段比特串，标识该序列的压缩数据的结束<br>MPEG-2的序列结束码为十六进制数000001(B7)。<br>5. 图像组编码对象</p>
<ol start="6">
<li>图像编码结构</li>
</ol>
<p>图像：<br>图像起始码：专有的一段比特串，标识一个图像的压缩数据的开始<br>MPEG-2的图像起始码为十六进制数000001(00)。<br>图像头：记录图像信息<br>图像编码类型，图像距离，图像编码结构，图像是否为逐行扫描。<br>7. 图像分块编码</p>
<ol start="8">
<li>条带编码结构</li>
</ol>
<p>条带：多个宏块的组合。<br>条带起始码：专有的一段比特串，标识一个条带的压缩数据的开始<br>MPEG-2的条带起始码为十六进制数000001(0~AF)。<br>条带头：记录当前图像的相关信息<br>条带位置，条带量化参数，宏块编码技术标识等。<br>9. 条带编码对象</p>
<ol start="10">
<li>宏块编码结构</li>
</ol>
<p>宏块：16x16的像素块（对亮度而言）。<br>宏块内容：宏块编码类型，编码模式，参考帧索引，运动矢量信息，宏块编码系数等。<br>11. 宏块编码对象</p>
<ol start="12">
<li>块编码结构</li>
</ol>
<p>8x8或4x4块的变换量化系数的熵编码数据。<br>CBP (Coded Block Patten)：用来指示块的变换量化系数是否全为零。<br>对于YUV(4:2:0)编码，CBP通常6比特长，每个比特对应一个块，当某一块的变换量化系数全为零时，其对应比特位值为0，否则为1。<br>每个块的变换量化系数的最后用一个EOB (End of Block)符号来标识。<br>13. 视频编解码关键技术</p>
<p>预测：通过帧内预测和帧间预测降低视频图像的空间冗余和时间冗余。<br>变换：通过从时域到频域的变换，去除相邻数据之间的相关性，即去除空间冗余。<br>量化：通过用更粗糙的数据表示精细的数据来降低编码的数据量，或者通过去除人眼不敏感的信息来降低编码数据量。<br>扫描：将二维变换量化数据重新组织成一维的数据序列。<br>熵编码：根据待编码数据的概率特性减少编码冗余。</p>
<ol start="14">
<li>预测</li>
</ol>
<p>空间预测：利用图像空间相邻像素的相关性来预测的方法。<br>帧内预测技术：利用当前编码块周围已经重构出来的像素预测当前块<br>Intra图像编码（I帧）<br>时间预测：利用时间上相邻图像的相关性来预测的方法。<br>帧间预测：运动估计（Motion Estimation，ME），运动补偿（Motion Compensation，MC）<br>Inter图像编码：前向预测编码图像（P帧），双向预测编码图像（B帧）<br>15. 帧内预测</p>
<p>I帧图像的每个宏块都采用帧内（Intra）预测编码模式。<br>宏块分成8x8或者4x4块，对每个块采用帧内预测编码，称作Intra8x8或者Intra4x4。<br>帧内预测有多个预测方向：水平，垂直，左下，右上。<br>帧内预测还有直流（DC）预测。<br>色度块预测还有平面预测。</p>
<ol start="16">
<li>帧间预测</li>
</ol>
<p>块基运动估计：为待预测块在参考帧上找到最佳的预测块，并记录预测块在参考帧上的相对位置。<br>运动矢量（MV）：参考帧上的预测块与当前帧上的的待预测块的相对位置。<br>MV有两个分量：（x，y）</p>
<p>分像素运动估计<br>最佳的预测块不在整像素位置，而在分像素位置；<br>1/2，1/4，1/8像素插值得到分像素值。</p>
<p>帧间预测流程：</p>
<p>运动补偿：给定MV和参考帧，为待解码块从参考帧上获取预测块。<br>运动矢量编码<br>MV预测：用当前块的周围可得到邻块的运动矢量来预测当前块的运动矢量<br>运动矢量差（MV difference，MVD）：实际运动矢量与预测运动矢量的差，即：<br>运动矢量差采用变长编码。</p>
<ol start="17">
<li>预测残差</li>
</ol>
<ol start="18">
<li>变换编码</li>
</ol>
<p>变换编码：通过变换将空域信号转换为频域信号来去除空间信号的冗余信息，减少编码数据。<br>二维离散余弦变换<br>4x4变换，8x8变换</p>
<p>二维离散余弦变换<br>例：</p>
<p>变换系数：直流（DC）系数，交流（AC）系数</p>
<ol start="19">
<li>量化</li>
</ol>
<p>量化原理：将含有大量的数据集合映射到含有少量的数据集合中。</p>
<p>一般情况下量化后高频部分包含大量的零系数</p>
<p>量化对主观质量的影响</p>
<ol start="20">
<li>扫描</li>
</ol>
<p>扫描：将二维数据转换为一维的数据序列。</p>
<ol start="21">
<li>熵编码</li>
</ol>
<p>熵编码：根据符号出现的概率，对经常出现的符号分配较短的码字，对不常出现的符号分配较长的码字。<br>Level-Run编码：用数据中非零值和其前面非零值之间出现零值的个数重新描述量化系数序列为（Level，Run）二元组序列</p>
<p>变长编码<br>将Level-Run编码后的（level，run）变长编码成最终的比特串。</p>
<ol start="22">
<li>码率控制</li>
</ol>
<p>受到缓冲区，带宽的限制，编码码率不能无限制的增长，因此需要通过码率控制来将编码码流控制在目标码率范围内。<br>一般通过调整量化参数的手段控制码率<br>帧级控制<br>条带级控制<br>宏块级控制<br>码率控制考虑的问题<br>防止码流有较大的波动，导致缓冲区发生溢出，<br>同时保持缓冲区尽可能的充满，让图像质量尽可能的好而且稳定<br>CBR（Constant Bit Rate）<br>比特率稳定，但图像质量变化大<br>VBR（Variable Bit Rate）<br>比特率波动大，但图像质量稳定<br>码率控制算法<br>码率分配<br>码率控制<br>码率控制属于非标准技术<br>编码端有，解码端没有<br>第5章 预测</p>
<ol>
<li>预测技术</li>
</ol>
<p>目的：去除空间冗余和时间冗余。<br>视频存在大量的空间冗余和时间冗余<br>空间冗余：用帧内预测编码去除<br>基于块的帧内预测<br>时间冗余：用帧间预测编码去除<br>基于块匹配（Block Matching）的帧间预测<br>预测后得到去除大部分空间或时间冗余的残差<br>2. 空间冗余</p>
<p>图像空间相邻像素具有很强的相关性。<br>帧内预测技术去除空间冗余</p>
<ol start="3">
<li>亮度预测模式</li>
</ol>
<ol start="4">
<li>色度预测模式</li>
</ol>
<ol start="5">
<li>时间冗余</li>
</ol>
<p>视频图像在时间上有较强的相关性，即存在时间冗余<br>去除时间冗余的编码技术<br>运动估计（Motion Estimation，ME）<br>为待编码块搜索最相似的预测块<br>记录运动矢量（Motion Vector，MV)<br>记录预测残差：<br>运动补偿（Motion Compensation，MC）<br>根据运动矢量获取预测块<br>根据预测残差计算重构块：</p>
<ol start="6">
<li>运动模型</li>
</ol>
<p>（1）平移</p>
<ol start="7">
<li>匹配准则</li>
</ol>
<ol start="8">
<li>匹配准则简化</li>
</ol>
<p>简化技术方法<br>分别计算当前块和预测块的象素值和<br>根据简化形式，比较当前块和预测块<br>如果用简化准则对预测块和当前块比较的结果比以前最好的结果差，可以确定预测效果不好，不必对预测块再进行比较。<br>9. 运动估计</p>
<p>去除视频图像的时间冗余<br>运动估计在搜索范围内为当前块寻找匹配最好的预测块<br>全搜索方式的运动估计计算复杂度高</p>
<ol start="10">
<li>全搜索复杂度分析</li>
</ol>
<p>图像大小：MxM<br>预测块大小：NxN<br>搜索范围：(-R，R)<br>每个搜索点象素比较个数：N2<br>搜索点个数(2R+1)2<br>在搜索范围内的象素比较个数总和N2(2R+1)2<br>一帧图像所有块的全搜索象素比较个数总和N2(2R+1)2(M/N)2=(2R+1)2M2<br>例：M=512，N=4，R=8，帧率：30帧/秒<br>(2R+1)2M2</p>
<p>=172X5122</p>
<p>= 75759616次/帧</p>
<p>= 75759616x30次/秒</p>
<p>=2272788480次/秒</p>
<p>采用SSD匹配准则：每次象素比较需1个减法，1个乘法，1个加法，则上述全搜索计算每秒需要2272788480x2次加减法和2272788480次乘法操作。</p>
<ol start="11">
<li>快速运动估计</li>
</ol>
<p>在保持预测精度的同时减少运动估计的搜索次数。<br>三步搜索（Three Step Search，TSS）<br>二维Log搜索（2D Logarithmic Search，2DLOG）<br>正交搜索（Orthogonal Search Algorithm，OSA）<br>十字搜索（Cross Search Algorithm，CSA）<br>新三步搜索（New Three Step Search，NTSS）<br>四步搜索（Four Step Search，FSS）<br>共轭方向搜索（Conjugate Direction Search，CDS）<br>梯度下降搜索（Gradient Descent Search，GDS）<br>层次块搜索（Hierarchical Block Matching Algorithm，HBMA）<br>12. 三步搜索</p>
<p>由粗到精搜索最优点，初始步长为R/2.<br>第一步：检查起始点和其周围步长为R/2的8个点，将最优点作为第二步的起始点；<br>第二步：以新的起始点为中心检查其周围步长为R/4的8个点，找到最优点作为第三步的起始点；<br>第三步：以新的起始点为中心检查其周围步长为R/8的8个点，找到最优点，如果R/8=1则搜索终止，最优点位置的预测块作为最优的预测块，否则重复该过程直到R/n2=1；<br>三步搜索方法检查点的个数为1+8log2（d+1），当d=8时，检查点个数为9+8+8=25</p>
<ol start="13">
<li>二维Log搜索</li>
</ol>
<p>每一步采用十字搜索模式<br>如果每一步的最优点为中心点或者搜索窗的边界点，搜索步长减半，否则搜索步长不变<br>当搜索步长为1时，中心点周围的8个点都要检查<br>两个搜索路径一个需要5+3+3+8=19，另外一个需要5+3+2+3+2+8=23</p>
<ol start="14">
<li>正交搜索</li>
</ol>
<p>起始搜索步长R/2，从起始点开始水平搜索三个点，得到最优点并沿着最优点垂直方向搜索相邻的两个点，得到最优点，以搜索步长为R/4再以同样的方式先水平再垂直搜索，当步长为1时停止搜索<br>搜索方法检查点的个数为1+4log2(d+1)，当d=8时，检查点个数为3+2+2+2+2+2=13。</p>
<ol start="15">
<li>十字搜索</li>
</ol>
<p>起始搜索步长R/2，从起始点开始以”X”形十字搜索，当搜索步长降为1时，如果上一步的最优点为中心点，左上点或右下点，则这一步搜索以”+”形状十字搜索，然后结束搜索，否则还是以”X”形十字搜索，然后结束搜索。<br>十字搜索方法检查点的个数为1+4log22d，当d=8时，检查点个数为5+4+4+4=17</p>
<ol start="16">
<li>新三步搜索</li>
</ol>
<p>与三步搜索方法不同的是，考虑到运动矢量高的中心分布特点，新三步搜索方法，除了围绕起始点为中心搜索步长为R/2的8个点之外，在起始点周围增加了步长为1的8个搜索点，如果最优点为步长为1的8个搜索点之一，则在最优点邻近的三个点中搜索最优点，然后结束搜索，否则，和三步搜索方法过程一样<br>其中一个搜索路径需要检查点个数为17+3=20，另一个需要17+8+8=33。</p>
<ol start="17">
<li>块梯度下降搜索</li>
</ol>
<p>该方法以起始点为中心搜索8个步长为1的相邻点，确定最优点，再以最优点为中心搜索8个步长为1的相邻点，如此循环下去，不限制搜索步骤，但当搜索得到的最优点为中心点或者到搜索窗的边界，搜索终止。</p>
<ol start="18">
<li>层次块搜索</li>
</ol>
<p>对编码图像和参考图像下采样，分别得到编码图像和参考图像的下采样图像，未经采样处理的编码图像和参考图像属于第0层，一次下采样的编码图像和参考图像属于第1层，对第1层图像再进行下采样得到的编码图像和参考图像属于第2层，依次重复上述过程，得到第n层下采样的编码图像和参考图像。<br>然后在n层下采样参考图像的搜索范围中找到与下采样编码图像块最佳匹配块的MV，该MV作为n-1层的运动估计搜索范围的中心点，依次重复上述过程，直到n=0为止，此时得到的最佳匹配块就是编码图像的预测块，其对应的MV为最终的最优MV。</p>
<ol start="19">
<li>搜索算法复杂度比较</li>
</ol>
<p>20 . 分像素运动估计与运动补偿</p>
<p>时域运动位置更可能在整象素之间，即分像素上。<br>利用相邻的整象素可以估计出分象素的值<br>常用线性或双线性插值得到分象素的值。<br>分象素运动估计有更高的预测精度，但复杂度也更高，<br>1/2分象素运动估计，图像存储空间增加4倍，运动矢量需要放大2倍，1/4分象素运动估计，图像存储空间增加16倍，运动矢量需要放大4倍，计算复杂度也成倍增加。</p>
<ol start="21">
<li>分像素插值</li>
</ol>
<ol start="22">
<li>多参考帧预测</li>
</ol>
<p>有更多的候选图像，搜索更精确的预测块<br>需要更多的参考图像存储空间<br>码流需要标识参考帧索引的语法元素</p>
<ol start="23">
<li>图像分块编码</li>
</ol>
<p>视频内容的运动非常复杂，图像分块编码可以更好的提高运动预测精度，提高压缩效率。<br>要在编码块大小和附信息（MV，Mode）编码比特数之间权衡，小的编码块大小会有更好的预测但有更多的附信息比特数。</p>
<ol start="23">
<li>双向预测编码</li>
</ol>
<ol start="24">
<li>B帧有更好的编码效率</li>
</ol>
<p>B帧有更好的编码效率<br>新出现的对象参考将来的帧有更好的预测效果<br>前后两个预测的平均值可以减少预测方差</p>
<ol start="25">
<li>全局运动估计</li>
</ol>
<p>基于全局仿射运动模型<br>预测精度不如基于块的运动估计<br>MV数目少，适合简单运动场景的运动估计</p>

</article>

    <div class="pagenator post-pagenator">
    
    
        <a class="extend prev post-prev" href="/2020/04/27/%E7%94%9F%E4%BA%A7%E7%AE%A1%E7%90%86%E5%AE%89%E7%81%AF-Andon-%E7%B3%BB%E7%BB%9F/">prev</a>
    

    
    <p>last update time 2020-04-26</p>
    
    
        <a class="extend next post-next" href="/2020/04/26/%E8%A7%86%E8%A7%89%E8%AF%86%E5%88%AB%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE/">next</a>
    
    </div>

    </div>
    <div class="footer">
        <div class="container">
    <div class="social">
	<ul class="social-list">
		
			
				
				
				<li>
					<a href="mailto:1178752402@qq.com" title="email" target="_blank">
					<i class="fa fa-email"></i>
					</a>
				</li>
			
		
			
		
			
		
			
		
			
		
			
		
			
				
				<li>
					<a href="https://github.com/CaiChenghan" title="github" target="_self">
					<i class="fa fa-github"></i>
					</a>
				</li>
			
		
			
		
			
		
			
		
			
				
				<li>
					<a href="https://www.jianshu.com/u/565c8e790605" title="jianshu" target="_self">
					<i class="fa fa-jianshu"></i>
					</a>
				</li>
			
		
			
		
			
		
			
		
	</ul>
</div>
    <div class="copyright">
        <span>
            
            
            
                © John Doe 2017 - 2020
            
        </span>
    </div>
    <div class="power">
        <span>
            Powered by <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> & <a href="https://github.com/CaiChenghan/iLiKE" target="_blank" rel="noopener">iLiKE Theme</a>
        </span>
    </div>
    <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.js"></script>
    <!--page counter part-->
<script>
function addCount (Counter) {
    url=$('.article-date').attr('href').trim();
    title = $('.article-title').text().trim();
    var query = new AV.Query(Counter);
    //use url as unique idnetfication
    query.equalTo("url",url);
    query.find({
        success: function(results) {
            if (results.length>0) {
                var counter=results[0];
                counter.fetchWhenSave(true); //get recent result
                counter.increment("time");
                counter.save();
            } else {
                var newcounter=new Counter();
                newcounter.set("title",title);
                newcounter.set("url",url);
                newcounter.set("time",1);
                newcounter.save(null,{
                    success: function(newcounter) {
                        //alert('New object created');
                    }, error: function(newcounter,error) {
                        alert('Failed to create');
                    }
                })
            }
        },
        error: function(error) {
            //find null is not a error
            alert('Error:'+error.code+" "+error.message);
        }
    });
}
$(function() {
    var Counter=AV.Object.extend("Counter");
    //only increse visit counting when intering a page
    if ($('.article-title').length == 1) {
       addCount(Counter);
    }
    var query=new AV.Query(Counter);
    query.descending("time");
    // the sum of popular posts
    query.limit(10); 
    query.find({
        success: function(results) {
                for(var i=0;i<results.length;i++) {
                    var counter=results[i];
                    title=counter.get("title");
                    url=counter.get("url");
                    time=counter.get("time");
                    // add to the popularlist widget
                    showcontent=title+" ("+time+")";
                    //notice the "" in href
                    $('.popularlist').append('<li><a href="'+url+'">'+showcontent+'</a></li>');
                }
            },
        error: function(error) {
            alert("Error:"+error.code+" "+error.message);
        }
    });
});
</script>
</div>
    </div>
</body>
</html>
